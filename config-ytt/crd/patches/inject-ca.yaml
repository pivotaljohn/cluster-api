#@ load("@ytt:overlay", "overlay")
#@ load("@ytt:data", "data"); d = data.values

#@ crd_names = [
#@   "clusters.cluster.x-k8s.io",
#@   "machinedeployments.cluster.x-k8s.io",
#@   "machinehealthchecks.cluster.x-k8s.io",
#@   "machines.cluster.x-k8s.io",
#@   "machinesets.cluster.x-k8s.io"
#@ ]

#@ def crd_named(name):
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: #@ name
#@ end

#@ for name in crd_names:
#@overlay/match by=overlay.subset(crd_named(name))
---
metadata:
  #@overlay/match missing_ok=True
  annotations:
    #@overlay/match missing_ok=True
    cert-manager.io/inject-ca-from: #@ d.certificate.namespace + "/" + d.certificate.name
#@ end
